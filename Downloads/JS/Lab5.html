<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/png" sizes="16x16" href="ICO/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="ICO/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="ICO/favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="ICO/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="ICO/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="ICO/android-chrome-512x512.png">
</head>
<body>
    <div id="chat-container">
        <ul id="chat-messages" style="list-style-type: none;"></ul>
    </div>
    <div id="input-container">
        <textarea maxlength="140" id="message-input"></textarea>
        <div id="char-count">0/140</div>
        <button id="send-button">SEND</button>
        <button id="theme-button">Dark Mode</button>
        <span id="rocket">ðŸš€</span>
    </div>

    <script type="application/javascript">
        const createMessageInput = () => {
            const sendButton = document.getElementById('send-button');
            const themeButton = document.getElementById('theme-button');
            const messageInput = document.getElementById('message-input');

            sendButton.addEventListener('click', postMessage);
            themeButton.addEventListener('click', toggleDarkMode);

            messageInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    postMessage();
                }
            });

            messageInput.addEventListener('input', updateCharCount);

            messageInput.style.width = '80%'; 
            messageInput.style.padding = '10px'; 
            messageInput.style.borderRadius = '5px'; 
            messageInput.style.border = '2px solid #ccc'; 
            messageInput.style.margin = 'auto'; 
            messageInput.style.display = 'block'; 
            messageInput.style.resize = 'none'; 
        };

        const getMessages = async () => {
            try {
                const response = await fetch('https://chat.tiburoncin.lat/messages');
                const messages = await response.json();

                const ul = document.getElementById('chat-messages');
                const lastMessageCount = ul.children.length;

                ul.innerHTML = '';

                messages.reverse().forEach((message) => {
                    const li = document.createElement('li');

                    if (message.message.match(/\.(png|jpg|jpeg|gif)$/i)) {
                        const img = document.createElement('img');
                        img.src = message.message;
                        img.classList.add('message-image');

                        const senderName = document.createElement('span');
                        senderName.textContent = message.username;
                        senderName.classList.add('sender-name');

                        li.appendChild(senderName);

                        if (message.username === 'Bianca_Cald') {
                            li.appendChild(document.createElement('br')); 
                            li.appendChild(img);
                            li.classList.add('user-message');
                        } else {
                            li.appendChild(img);
                            li.classList.add('other-message');
                        }
                    } else {
                        const messageText = document.createElement('span');
                        messageText.textContent = `${message.username}: ${message.message}`;
                        li.appendChild(messageText);

                        if (message.username === 'Bianca_Cald') {
                            li.style.textAlign = 'left';
                            li.style.marginLeft = 'auto';
                            li.style.padding = '10px 0 10px 10px';
                        } else {
                            li.style.textAlign = 'left';
                        }

                        li.style.background = `linear-gradient(to right, ${message.username === 'Bianca_Cald' ? '#DC143C' : '#00CED1'}, ${message.username === 'Bianca_Cald' ? '#FFA500' : '#FC9305'})`;
                        li.style.color = '#fff';
                        li.style.borderRadius = '5px';
                        li.style.padding = '10px';
                        li.style.marginBottom = '5px';
                        li.style.maxWidth = '40%'; 
                    }
                    

                    ul.appendChild(li);

                    setTimeout(() => {
                        li.style.opacity = 1;
                        li.style.transform = 'translateY(0)';
                    }, 100);
                });

                const newMessageCount = ul.children.length;
                if (newMessageCount > lastMessageCount) {
                    setTimeout(() => {
                        getMessages();
                        const chatContainer = document.getElementById('chat-container');
                        chatContainer.scrollTop = chatContainer.scrollHeight; 
                    },); 
                }
            } catch (error) {
                console.error('Error fetching messages:', error);
                setTimeout(getMessages, 5000);
            }
        };

        const postMessage = async () => {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value;

            const body = {
                username: 'Bianca_Cald',
                message: message,
            };
            await fetch('https://chat.tiburoncin.lat/messages', {
                method: 'POST',
                body: JSON.stringify(body)
            });
            messageInput.value = '';
            updateCharCount();
            getMessages(); 
        };

        const setTheme = (theme) => {
            const chatContainer = document.getElementById('chat-container');
            const inputContainer = document.getElementById('input-container');
            const themeButton = document.getElementById('theme-button');

            document.body.style.backgroundColor = theme === 'black' ? 'black' : 'white';
            chatContainer.style.color = theme === 'black' ? 'white' : 'black';
            inputContainer.style.backgroundColor = theme === 'black' ? '#333' : '#8d8d8d';
            themeButton.textContent = theme === 'black' ? 'Light Mode' : 'Dark Mode';
        };

        const toggleDarkMode = () => {
            const theme = localStorage.getItem('Theme') === 'black' ? 'white' : 'black';
            localStorage.setItem('Theme', theme); 
            setTheme(theme);
        };

        const updateCharCount = () => {
            const messageInput = document.getElementById('message-input');
            const charCount = document.getElementById('char-count');
            charCount.innerText = `${messageInput.value.length}/140`;
        };

        const initializeChat = () => {
            createMessageInput();
            getMessages();
            const savedTheme = localStorage.getItem('Theme') || 'white'; 
            setTheme(savedTheme); 

            const inputContainer = document.getElementById('input-container');
            inputContainer.style.position = 'fixed';
            inputContainer.style.bottom = '0';
            inputContainer.style.left = '0';
            inputContainer.style.width = '100%';

            const messageInput = document.getElementById('message-input');
            const charCountContainer = document.createElement('div');
            charCountContainer.style.float = 'right';
            charCountContainer.style.marginRight = '10px';
            inputContainer.insertBefore(charCountContainer, messageInput.nextSibling);

            const charCount = document.getElementById('char-count');
            charCountContainer.appendChild(charCount);
            charCountContainer.style.display = 'inline-block';
            charCountContainer.style.padding = '5px 10px';
            charCountContainer.style.borderRadius = '5px';
            charCountContainer.style.backgroundColor = '#f0f0f0';
            charCountContainer.style.color = '#666';
            charCountContainer.style.fontFamily = 'Arial, sans-serif';
            charCountContainer.style.fontSize = '14px';

            const chatContainer = document.getElementById('chat-container');
            chatContainer.style.overflowY = 'auto';
            chatContainer.style.overflowX = 'hidden';
            chatContainer.style.maxHeight = 'calc(100vh - 100px)'; 
            chatContainer.style.margin = '0';
            chatContainer.style.padding = '0';
            
            document.body.style.margin = '0';
            document.body.style.padding = '0';
            
            const sendButton = document.getElementById('send-button');
            const themeButton = document.getElementById('theme-button');

            [sendButton, themeButton].forEach(button => {
                button.style.background = button.id === 'send-button' ? '#4CAF50' : '#008CBA';
                button.style.color = 'white';
                button.style.border = 'none';
                button.style.padding = '10px 20px';
                button.style.textAlign = 'center';
                button.style.textDecoration = 'none';
                button.style.display = 'inline-block';
                button.style.fontSize = '16px';
                button.style.marginTop = '10px';
                button.style.cursor = 'pointer';
            });
        };

        window.onload = initializeChat;
        setInterval(getMessages, 5000);
    </script>
</body>
</html>
