<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/png" sizes="16x16" href="ICO/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="ICO/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="32x32" href="ICO/favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="ICO/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="ICO/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="ICO/android-chrome-512x512.png">
</head>
<body>
    <div id="chat-container">
        <ul id="chat-messages"></ul>
    </div>
    <div id="input-container">
        <textarea maxlength="140" id="message-input"></textarea>
        <div id="char-count">0/140</div>
        <button id="send-button">SEND</button>
        <button id="theme-button">Dark Mode</button>
    </div>

    <script type="application/javascript">

        
        const createMessageInput = () => {
            const sendButton = document.getElementById('send-button');
            const themeButton = document.getElementById('theme-button');
            const messageInput = document.getElementById('message-input');

            sendButton.addEventListener('click', postMessage);
            themeButton.addEventListener('click', toggleDarkMode);

            messageInput.addEventListener('input', () => {
                const charCount = document.getElementById('char-count');
                charCount.innerText = `${messageInput.value.length}/140`;
            });

            messageInput.style.width = '80%'; 
            messageInput.style.padding = '10px'; 
            messageInput.style.borderRadius = '5px'; 
            messageInput.style.border = '2px solid #ccc'; 
            messageInput.style.margin = 'auto'; 
            messageInput.style.display = 'block'; 
            messageInput.style.resize = 'none'; 

            const ul = document.getElementById('chat-messages');
        };

        const getMessages = async () => {
            try {
                const response = await fetch('https://chat.tiburoncin.lat/messages');
                const messages = await response.json();

                const ul = document.getElementById('chat-messages');
                const lastMessageCount = ul.children.length;

                ul.innerHTML = '';

                messages.reverse().forEach((message) => {
                    const li = document.createElement('li');

                    if (message.message.startsWith('http') && (message.message.endsWith('.png') || message.message.endsWith('.jpg') || message.message.endsWith('.jpeg') || message.message.endsWith('.gif'))) {
                        const img = document.createElement('img');
                        img.src = message.message;
                        img.classList.add('message-image');
                        li.appendChild(img);
                    } else {
                        const messageText = document.createElement('span');
                        messageText.textContent = `${message.username}: ${message.message}`;
                        li.appendChild(messageText);

                        li.style.background = `linear-gradient(to right, ${message.username === 'Bianca_Cald' ? '#DC143C' : '#00CED1'}, ${message.username === 'Bianca_Cald' ? '#FFA500' : '#FC9305'})`;
                        li.style.color = '#fff';
                        li.style.borderRadius = '5px';
                        li.style.padding = '10px';
                        li.style.marginBottom = '5px';

                        li.classList.add(message.username === 'Bianca_Cald' ? 'user-message' : 'other-message');
                    }

                    ul.appendChild(li);

                    setTimeout(() => {
                        li.style.opacity = 1;
                        li.style.transform = 'translateY(0)';
                    }, 100);
                });

                const newMessageCount = ul.children.length;
                if (newMessageCount > lastMessageCount) {
                    setTimeout(() => {
                        getMessages();
                        ul.lastChild.scrollIntoView({ behavior: 'smooth', block: 'end' }); 
                    }, 5000); 
                }
            } catch (error) {
                console.error('Error fetching messages:', error);
                setTimeout(getMessages, 5000);
            }
        };

        const postMessage = async () => {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value;

            const body = {
                username: 'Bianca_Cald',
                message: message,
            };
            await fetch('https://chat.tiburoncin.lat/messages', {
                method: 'POST',
                body: JSON.stringify(body)
            });
            messageInput.value = '';
            updateCharCount();
            getMessages(); 
        };

        const setTheme = (theme) => {
            const chatContainer = document.getElementById('chat-container');
            const messageList = document.getElementById('chat-messages');
            const inputContainer = document.getElementById('input-container');
            const themeButton = document.getElementById('theme-button');

            if (theme === 'black') {
                document.body.style.backgroundColor = 'black';
                chatContainer.style.color = 'white';
                inputContainer.style.backgroundColor = "#333";
                themeButton.textContent = 'Light Mode';
            } else {
                document.body.style.backgroundColor = 'white';
                chatContainer.style.color = 'black';
                inputContainer.style.backgroundColor = "#8d8d8d";
                themeButton.textContent = 'Dark Mode';
            }
            themeButton.textContent = theme === 'black' ? 'Light Mode' : 'Dark Mode';
        };

        const toggleDarkMode = () => {
            let theme = localStorage.getItem('Theme') === 'black' ? 'white' : 'black';
            localStorage.setItem('Theme', theme); 
            setTheme(theme);
        };


        const updateCharCount = () => {
            const messageInput = document.getElementById('message-input');
            const charCount = document.getElementById('char-count');
            charCount.innerText = `${messageInput.value.length}/140`;
        };

        const initializeChat = () => {
    createMessageInput();
    getMessages();
    const savedTheme = localStorage.getItem('Theme') || 'white'; 
    setTheme(savedTheme); 

    const inputContainer = document.getElementById('input-container');
    inputContainer.style.position = 'fixed';
    inputContainer.style.bottom = '0';
    inputContainer.style.left = '0';
    inputContainer.style.width = '100%';

    const messageInput = document.getElementById('message-input');
    const charCountContainer = document.createElement('div');
    charCountContainer.style.float = 'right';
    charCountContainer.style.marginRight = '10px';
    inputContainer.insertBefore(charCountContainer, messageInput.nextSibling);

    const charCount = document.getElementById('char-count');
    charCountContainer.appendChild(charCount);
    charCountContainer.style.display = 'inline-block';
    charCountContainer.style.padding = '5px 10px';
    charCountContainer.style.borderRadius = '5px';
    charCountContainer.style.backgroundColor = '#f0f0f0';
    charCountContainer.style.color = '#666';
    charCountContainer.style.fontFamily = 'Arial, sans-serif';
    charCountContainer.style.fontSize = '14px';

    const chatContainer = document.getElementById('chat-container');
    chatContainer.style.overflowY = 'auto';
    chatContainer.style.overflowX = 'hidden';
    chatContainer.style.maxHeight = 'calc(100vh - 100px)';
    chatContainer.style.margin = '0';
    chatContainer.style.padding = '0';
    
    document.body.style.margin = '0';
    document.body.style.padding = '0';
    
    const sendButton = document.getElementById('send-button');
    sendButton.style.background = '#4CAF50';
    sendButton.style.color = 'white';
    sendButton.style.border = 'none';
    sendButton.style.padding = '10px 20px';
    sendButton.style.textAlign = 'center';
    sendButton.style.textDecoration = 'none';
    sendButton.style.display = 'inline-block';
    sendButton.style.fontSize = '16px';
    sendButton.style.marginTop = '10px';
    sendButton.style.cursor = 'pointer';

    const themeButton = document.getElementById('theme-button');
    themeButton.style.background = '#008CBA';
    themeButton.style.color = 'white';
    themeButton.style.border = 'none';
    themeButton.style.padding = '10px 20px';
    themeButton.style.textAlign = 'center';
    themeButton.style.textDecoration = 'none';
    themeButton.style.display = 'inline-block';
    themeButton.style.fontSize = '16px';
    themeButton.style.marginTop = '10px';
    themeButton.style.cursor = 'pointer';
    
    const alignMessage = (message, isUser) => {
        const li = document.createElement('li');

        if (message.message.startsWith('http') && (message.message.endsWith('.png') || message.message.endsWith('.jpg') || message.message.endsWith('.jpeg') || message.message.endsWith('.gif'))) {
            const img = document.createElement('img');
            img.src = message.message;
            img.classList.add('message-image');
            li.appendChild(img);
        } else {
            const messageText = document.createElement('span');
            messageText.textContent = `${message.username}: ${message.message}`;
            li.appendChild(messageText);

            li.style.background = isUser ? '#0084ff' : '#e5e5ea';
            li.style.color = isUser ? 'white' : 'black';
            li.style.borderRadius = '10px';
            li.style.padding = '10px';
            li.style.marginBottom = '5px';
            li.style.clear = isUser ? 'both' : 'none';
            li.style.float = isUser ? 'right' : 'left';
            li.style.maxWidth = '70%';
            li.style.wordWrap = 'break-word'; 
        }

        chatContainer.appendChild(li);

        setTimeout(() => {
            li.style.opacity = 1;
            li.style.transform = 'translateY(0)';
        }, 100);
    };
};

        setInterval(getMessages, 5000);
        window.onload = initializeChat;
    </script>
</body>
</html>
